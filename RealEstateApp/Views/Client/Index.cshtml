@using RealEstateApp.Core.Application.ViewModels.Property
@using RealEstateApp.Core.Application.Helpers
@using RealEstateApp.Core.Application.Dtos.Account
@model List<PropertyVm>

@inject IHttpContextAccessor httpContextAccesor
@{
    ViewData["Title"] = "Home";
    var user =  httpContextAccesor.HttpContext.Session.Get<AuthenticationResponse>("user");
   
}

<div class="container-fluid">

    <div class="row mb-3">
        <!-- Formularios de Búsqueda y Filtros -->
        <form asp-controller="Client" asp-action="Index" method="get" class="row g-3 mb-4">
            <div class="col-md-3">
                <label for="code" class="form-label">Buscar por código</label>
                <input type="text" name="code" class="form-control" placeholder="Ej: 123456" />
            </div>

            <div class="col-md-3">
                <label for="propertyTypes" class="form-label">Tipo de propiedad</label>
                <select class="form-select" name="propertyTypes" multiple>
                    @if (ViewBag.PropertyTypes != null)
                    {
                        foreach (var type in ViewBag.PropertyTypes)
                        {
                            <option value="@type.Value">@type.Text</option>
                        }
                    }
                </select>
                <small class="text-muted">Mantén presionado Ctrl (Cmd en Mac) para seleccionar varios</small>
            </div>

            <div class="col-md-2">
                <label class="form-label">Precio mínimo</label>
                <input type="number" name="minPrice" class="form-control" />
            </div>

            <div class="col-md-2">
                <label class="form-label">Precio máximo</label>
                <input type="number" name="maxPrice" class="form-control" />
            </div>

            <div class="col-md-1">
                <label class="form-label">Habitaciones</label>
                <input type="number" name="bedrooms" class="form-control" />
            </div>

            <div class="col-md-1">
                <label class="form-label">Baños</label>
                <input type="number" name="bathrooms" class="form-control" />
            </div>

            <div class="col-md-12 text-end">
                <button type="submit" class="btn btn-primary">Filtrar</button>
            </div>
        </form>
    </div>

    <div class="row">

        

        @if(Model==null || Model.Count==0)
        {
            <h2>No hay propiedades</h2>
        }
        else
        {
            @foreach(PropertyVm item in Model)
            {
               
                <div class="col-4">
                    <div class="card shadow-sm">
                        <img class="bd-placeholder-img card-img-top" src="@item.PropertyImageVms.Select(i=>i.ImageUrl).FirstOrDefault()" />
                        <h4 class="card-title">@item.PropertyTypeVm.Name</h4>
                        <p class="card-text">Descripcion: @item.PropertyTypeVm.Description</p>
                        <p class="card-text">Codigo: @item.Code</p>
                        <p class="card-text">Precio: @item.Price</p>
                        <p class="card-text">Metros: @item.PropertySize</p>
                        <p class="card-text">Baños: @item.AmountOfBathroom</p>
                        <p class="card-text">Habitaciones: @item.AmountOfRoom</p>

                        <div class="btn-group">

                            <!--Si hay una propiedad q sea favorita el boton es diferente-->
                            @if (item.FavoritePropertyVms.Any(fp => fp.PropertyId == item.Id))
                            {
                                <a asp-controller="Client" asp-action="ToggleFavoriteProperty" asp-route-id="@item.Id" asp-route-clientId="@user.Id" class="btn btn-sm btn-outline-info">Quitar de favoritos</a>
                            }
                            else
                            {
                                <a asp-controller="Client" asp-action="ToggleFavoriteProperty" asp-route-id="@item.Id" asp-route-clientId="@user.Id" class="btn btn-sm btn-outline-info">Añadir a favorito</a>

                            }
                            
                            <!--OJO NO ES UN BOTON EN SI, ESTO DEBERIA SER CUANDO SE PRESIONE LA TARJETA DONDE ESTA LA PROPIEDAD... -->
                            <a asp-controller="Client" asp-action="PropertyDeatails" asp-route-id="@item.Id" class="btn btn-sm btn-outline-info">Detalles de la propiedad</a>
                        </div>

                        


                    </div>
                </div>
            
            }
        }
    </div>
 
</div>